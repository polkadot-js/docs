"use strict";(self.webpackChunkpolkadot_js=self.webpackChunkpolkadot_js||[]).push([[3142],{4137:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return k}});var i=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=i.createContext({}),p=function(e){var t=i.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=p(e.components);return i.createElement(l.Provider,{value:t},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},m=i.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),c=p(n),m=a,k=c["".concat(l,".").concat(m)]||c[m]||d[m]||r;return n?i.createElement(k,o(o({ref:t},u),{},{components:n})):i.createElement(k,o({ref:t},u))}));function k(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,o=new Array(r);o[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[c]="string"==typeof e?e:a,o[1]=s;for(var p=2;p<r;p++)o[p]=n[p];return i.createElement.apply(null,o)}return i.createElement.apply(null,n)}m.displayName="MDXCreateElement"},1399:function(e,t,n){n.r(t),n.d(t,{assets:function(){return u},contentTitle:function(){return l},default:function(){return k},frontMatter:function(){return s},metadata:function(){return p},toc:function(){return c}});var i=n(7462),a=n(3366),r=(n(7294),n(4137)),o=["components"],s={},l="sr25519 Migration Guide",p={unversionedId:"util-crypto/sr25519-migration",id:"util-crypto/sr25519-migration",title:"sr25519 Migration Guide",description:"Overview",source:"@site/docs/util-crypto/sr25519-migration.md",sourceDirName:"util-crypto",slug:"/util-crypto/sr25519-migration",permalink:"/docs/util-crypto/sr25519-migration",draft:!1,editUrl:"https://github.com/polkadot-js/docs/edit/master/docs/util-crypto/sr25519-migration.md",tags:[],version:"current",frontMatter:{},sidebar:"reference",previous:{title:"Overview",permalink:"/docs/util-crypto"},next:{title:"Overview",permalink:"/docs/util-crypto/examples"}},u={},c=[{value:"Overview",id:"overview",level:2},{value:"Breaking Changes",id:"breaking-changes",level:2},{value:"1. Synchronous Operations (No More <code>async</code>/<code>await</code>)",id:"1-synchronous-operations-no-more-asyncawait",level:3},{value:"2. No WASM Initialization",id:"2-no-wasm-initialization",level:3},{value:"Migration Checklist",id:"migration-checklist",level:2},{value:"API Changes",id:"api-changes",level:2},{value:"Key Generation",id:"key-generation",level:3},{value:"Signing",id:"signing",level:3},{value:"Verification",id:"verification",level:3},{value:"Key Derivation",id:"key-derivation",level:3},{value:"VRF Operations",id:"vrf-operations",level:3},{value:"Performance Considerations",id:"performance-considerations",level:2},{value:"Bundle Size",id:"bundle-size",level:3},{value:"Execution Speed",id:"execution-speed",level:3},{value:"When to Use",id:"when-to-use",level:3},{value:"Security &amp; Audits",id:"security--audits",level:2},{value:"Node.js Version Requirements",id:"nodejs-version-requirements",level:2},{value:"Common Patterns",id:"common-patterns",level:2},{value:"Before &amp; After Examples",id:"before--after-examples",level:3},{value:"Example 1: Creating and Signing with a Keypair",id:"example-1-creating-and-signing-with-a-keypair",level:4},{value:"Example 2: Batch Verification",id:"example-2-batch-verification",level:4},{value:"Example 3: Initialization in React",id:"example-3-initialization-in-react",level:4},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"&quot;Function is not async but I&#39;m using await&quot;",id:"function-is-not-async-but-im-using-await",level:3},{value:"&quot;cryptoWaitReady is not defined&quot;",id:"cryptowaitready-is-not-defined",level:3},{value:"&quot;Performance seems slower&quot;",id:"performance-seems-slower",level:3},{value:"&quot;TypeScript errors about async/await&quot;",id:"typescript-errors-about-asyncawait",level:3},{value:"Additional Resources",id:"additional-resources",level:2},{value:"Questions or Issues?",id:"questions-or-issues",level:2}],d={toc:c},m="wrapper";function k(e){var t=e.components,n=(0,a.Z)(e,o);return(0,r.kt)(m,(0,i.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"sr25519-migration-guide"},"sr25519 Migration Guide"),(0,r.kt)("h2",{id:"overview"},"Overview"),(0,r.kt)("p",null,"Polkadot.js has migrated from WASM-based sr25519 cryptography to ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/paulmillr/scure-sr25519"},(0,r.kt)("inlineCode",{parentName:"a"},"@scure/sr25519")),", a pure JavaScript implementation. This change brings several benefits:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"No WASM initialization required")," - Functions are now synchronous"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Smaller bundle size")," - Few lines of pure JS vs WASM binaries"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Better compatibility")," - Works seamlessly across all JavaScript environments"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Audited & secure")," - Multiple independent security audits by Oak Security")),(0,r.kt)("h2",{id:"breaking-changes"},"Breaking Changes"),(0,r.kt)("h3",{id:"1-synchronous-operations-no-more-asyncawait"},"1. Synchronous Operations (No More ",(0,r.kt)("inlineCode",{parentName:"h3"},"async"),"/",(0,r.kt)("inlineCode",{parentName:"h3"},"await"),")"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Before (WASM):")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"import { cryptoWaitReady, sr25519Sign } from '@polkadot/util-crypto';\n\nasync function signMessage() {\n  // Wait for WASM to initialize\n  await cryptoWaitReady();\n  \n  const signature = await sr25519Sign(message, keypair);\n  return signature;\n}\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"After (Pure JS):")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"import { sr25519Sign } from '@polkadot/util-crypto';\n\nfunction signMessage() {\n  // No initialization needed - works immediately\n  const signature = sr25519Sign(message, keypair);\n  return signature;\n}\n")),(0,r.kt)("h3",{id:"2-no-wasm-initialization"},"2. No WASM Initialization"),(0,r.kt)("p",null,"You no longer need to call ",(0,r.kt)("inlineCode",{parentName:"p"},"cryptoWaitReady()")," for sr25519 operations. The following patterns are now unnecessary:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"// OLD - No longer needed\nawait cryptoWaitReady();\n\n// OLD - No longer needed\nif (isReady) {\n  // sr25519 operations\n}\n")),(0,r.kt)("p",null,"All sr25519 functions are ready to use immediately upon import."),(0,r.kt)("h2",{id:"migration-checklist"},"Migration Checklist"),(0,r.kt)("ul",{className:"contains-task-list"},(0,r.kt)("li",{parentName:"ul",className:"task-list-item"},(0,r.kt)("input",{parentName:"li",type:"checkbox",checked:!1,disabled:!0})," ","Remove ",(0,r.kt)("inlineCode",{parentName:"li"},"await")," from sr25519 function calls"),(0,r.kt)("li",{parentName:"ul",className:"task-list-item"},(0,r.kt)("input",{parentName:"li",type:"checkbox",checked:!1,disabled:!0})," ","Remove ",(0,r.kt)("inlineCode",{parentName:"li"},"cryptoWaitReady()")," calls if only used for sr25519"),(0,r.kt)("li",{parentName:"ul",className:"task-list-item"},(0,r.kt)("input",{parentName:"li",type:"checkbox",checked:!1,disabled:!0})," ","Remove ",(0,r.kt)("inlineCode",{parentName:"li"},"async")," from functions that only contained sr25519 operations"),(0,r.kt)("li",{parentName:"ul",className:"task-list-item"},(0,r.kt)("input",{parentName:"li",type:"checkbox",checked:!1,disabled:!0})," ","Update error handling (no more promise rejections)"),(0,r.kt)("li",{parentName:"ul",className:"task-list-item"},(0,r.kt)("input",{parentName:"li",type:"checkbox",checked:!1,disabled:!0})," ","Test synchronous execution flow in your application")),(0,r.kt)("h2",{id:"api-changes"},"API Changes"),(0,r.kt)("h3",{id:"key-generation"},"Key Generation"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"// NEW - Synchronous\nimport { sr25519PairFromSeed } from '@polkadot/util-crypto';\n\nconst seed = new Uint8Array(32); // Your seed\nconst keypair = sr25519PairFromSeed(seed);\n")),(0,r.kt)("h3",{id:"signing"},"Signing"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"// NEW - Synchronous\nimport { sr25519Sign } from '@polkadot/util-crypto';\n\nconst message = new Uint8Array([1, 2, 3, 4]);\nconst signature = sr25519Sign(message, keypair);\n")),(0,r.kt)("h3",{id:"verification"},"Verification"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"// NEW - Synchronous\nimport { sr25519Verify } from '@polkadot/util-crypto';\n\nconst isValid = sr25519Verify(message, signature, publicKey);\n")),(0,r.kt)("h3",{id:"key-derivation"},"Key Derivation"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"// NEW - Synchronous\nimport { sr25519DeriveHard, sr25519DeriveSoft } from '@polkadot/util-crypto';\n\n// Hard derivation\nconst derived = sr25519DeriveHard(keypair, chainCode);\n\n// Soft derivation\nconst derivedSoft = sr25519DeriveSoft(keypair, chainCode);\n")),(0,r.kt)("h3",{id:"vrf-operations"},"VRF Operations"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"// NEW - Synchronous\nimport { sr25519VrfSign, sr25519VrfVerify } from '@polkadot/util-crypto';\n\nconst vrfSignature = sr25519VrfSign(message, keypair, context);\nconst vrfValid = sr25519VrfVerify(message, vrfSignature, publicKey, context);\n")),(0,r.kt)("h2",{id:"performance-considerations"},"Performance Considerations"),(0,r.kt)("h3",{id:"bundle-size"},"Bundle Size"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"WASM implementation"),": ~100KB+ (WASM binary + JS wrapper)"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Pure JS implementation"),": ~15KB minified")),(0,r.kt)("h3",{id:"execution-speed"},"Execution Speed"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Pure JS may be slightly slower than WASM for bulk operations"),(0,r.kt)("li",{parentName:"ul"},"For typical single-signature operations, the difference is negligible"),(0,r.kt)("li",{parentName:"ul"},"No initialization overhead (WASM required loading and compilation)")),(0,r.kt)("h3",{id:"when-to-use"},"When to Use"),(0,r.kt)("p",null,"The pure JS implementation is ideal for:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Browser applications (smaller bundles, faster load times)"),(0,r.kt)("li",{parentName:"ul"},"Server-side applications (no WASM compilation overhead)"),(0,r.kt)("li",{parentName:"ul"},"Mobile applications (better compatibility)"),(0,r.kt)("li",{parentName:"ul"},"Applications requiring immediate cryptographic operations")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"You can optionally call ",(0,r.kt)("inlineCode",{parentName:"p"},"cryptoWaitReady()")," during initialization to ensure async crypto imports are fully available before use. This works safely alongside synchronous usage and won\u2019t interfere with other crypto imports, which can be useful in projects that rely on multiple crypto libraries or shared initialization logic.")),(0,r.kt)("h2",{id:"security--audits"},"Security & Audits"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"@scure/sr25519")," library has undergone multiple independent security audits. All audit reports are publicly available:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/oak-security/audit-reports/tree/main/Polkadot"},"Oak Security Audit Reports"))),(0,r.kt)("p",null,"The library was funded by the Polkadot Treasury and developed specifically for the Polkadot ecosystem."),(0,r.kt)("h2",{id:"nodejs-version-requirements"},"Node.js Version Requirements"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Current"),": Node.js v18+ (using ",(0,r.kt)("inlineCode",{parentName:"li"},"@scure/sr25519")," v0.2.x)"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Future"),": Node.js v20+ recommended (for ESM-only v0.3.x/v1.x updates)")),(0,r.kt)("h2",{id:"common-patterns"},"Common Patterns"),(0,r.kt)("h3",{id:"before--after-examples"},"Before & After Examples"),(0,r.kt)("h4",{id:"example-1-creating-and-signing-with-a-keypair"},"Example 1: Creating and Signing with a Keypair"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"// OLD\nimport { cryptoWaitReady, sr25519PairFromSeed } from '@polkadot/util-crypto';\n\nasync function createAndSign(seed, message) {\n  await cryptoWaitReady();\n  const pair = sr25519PairFromSeed(seed);\n  return pair.sign(message);\n}\n\n// NEW\nimport { sr25519PairFromSeed } from '@polkadot/util-crypto';\n\nfunction createAndSign(seed, message) {\n  const pair = sr25519PairFromSeed(seed);\n  return pair.sign(message);\n}\n")),(0,r.kt)("h4",{id:"example-2-batch-verification"},"Example 2: Batch Verification"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"// OLD\nasync function verifyMultiple(signatures) {\n  await cryptoWaitReady();\n  return signatures.map(({ msg, sig, pub }) => \n    sr25519Verify(msg, sig, pub)\n  );\n}\n\n// NEW\nfunction verifyMultiple(signatures) {\n  return signatures.map(({ msg, sig, pub }) => \n    sr25519Verify(msg, sig, pub)\n  );\n}\n")),(0,r.kt)("h4",{id:"example-3-initialization-in-react"},"Example 3: Initialization in React"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"// OLD\nfunction MyComponent() {\n  const [ready, setReady] = useState(false);\n  \n  useEffect(() => {\n    cryptoWaitReady().then(() => setReady(true));\n  }, []);\n  \n  if (!ready) return <Loading />;\n  return <App />;\n}\n\n// NEW\nfunction MyComponent() {\n  // No initialization needed - just use it!\n  return <App />;\n}\n")),(0,r.kt)("h2",{id:"troubleshooting"},"Troubleshooting"),(0,r.kt)("h3",{id:"function-is-not-async-but-im-using-await"},'"Function is not async but I\'m using await"'),(0,r.kt)("p",null,"Remove the ",(0,r.kt)("inlineCode",{parentName:"p"},"await")," keyword - sr25519 functions are now synchronous."),(0,r.kt)("h3",{id:"cryptowaitready-is-not-defined"},'"cryptoWaitReady is not defined"'),(0,r.kt)("p",null,"Remove calls to ",(0,r.kt)("inlineCode",{parentName:"p"},"cryptoWaitReady()")," - it's no longer needed for sr25519 operations."),(0,r.kt)("h3",{id:"performance-seems-slower"},'"Performance seems slower"'),(0,r.kt)("p",null,"For bulk operations, consider batching or using Web Workers. For typical use cases, performance should be comparable or better due to no initialization overhead."),(0,r.kt)("h3",{id:"typescript-errors-about-asyncawait"},'"TypeScript errors about async/await"'),(0,r.kt)("p",null,"Update your function signatures to remove ",(0,r.kt)("inlineCode",{parentName:"p"},"async")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"Promise")," return types for sr25519 operations."),(0,r.kt)("h2",{id:"additional-resources"},"Additional Resources"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/paulmillr/scure-sr25519"},(0,r.kt)("inlineCode",{parentName:"a"},"@scure/sr25519")," GitHub Repository")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://polkadot.js.org/docs/"},"Polkadot.js Documentation")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/polkadot-js/common/pull/1971"},"Original PR Discussion")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/oak-security/audit-reports/tree/main/Polkadot"},"Oak Security Audit Reports"))),(0,r.kt)("h2",{id:"questions-or-issues"},"Questions or Issues?"),(0,r.kt)("p",null,"If you encounter any issues during migration:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Check this guide for common patterns"),(0,r.kt)("li",{parentName:"ol"},"Review the ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/polkadot-js/common/issues"},"@polkadot-js/common GitHub issues")),(0,r.kt)("li",{parentName:"ol"},"Open an issue on the ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/polkadot-js/common/issues/new"},"@polkadot-js/common repository"))),(0,r.kt)("hr",null))}k.isMDXComponent=!0}}]);